<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Controle de Produção</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
        th { background-color: #f2f2f2; }
        .positivo { color: green; font-weight: bold; }
        .atrasado { color: red; font-weight: bold; }
        #buscarBtn { padding: 6px 12px; cursor: pointer; }
        #programaInput { padding: 6px; width: 200px; }
    </style>
</head>
<body>

<h2>Controle de Produção</h2>

<label for="programaInput">Programa:</label>
<input type="text" id="programaInput" placeholder="Digite o código do programa">
<button id="buscarBtn">Buscar</button>

<table id="tabelaProducao">
    <thead>
        <tr>
            <th>Numeração</th>
            <th>Número de Matrizes</th>
            <th>Saldo Giros Inicial</th>
            <th>Saldo Giros Atual</th>
            <th>Horas Produzidas</th>
            <th>Tempo</th>
        </tr>
    </thead>
    <tbody>
        <!-- Dados vão aparecer aqui -->
    </tbody>
</table>

<script>
    // Detecta o ambiente e define a URL base da API
    const apiBaseUrl = window.location.hostname === "localhost"
        ? "http://localhost:3000/api" // backend local
        : "https://producao-calcados-suza.vercel.app/api/programa"; // backend em produção

    function atualizarTabela(dados) {
        const tbody = document.querySelector("#tabelaProducao tbody");
        tbody.innerHTML = "";

        dados.forEach(item => {
            const tr = document.createElement("tr");

            const tempo = item.horas_produzidas - item.tempo_planejado;
            const tempoClasse = tempo >= 0 ? "positivo" : "atrasado";
            const tempoTexto = tempo >= 0 ? `+${tempo.toFixed(2)}` : `${tempo.toFixed(2)}`;

            tr.innerHTML = `
                <td>${item.numeracao}</td>
                <td>${item.num_matrizes}</td>
                <td>${item.saldo_inicial}</td>
                <td>${item.saldo_atual}</td>
                <td>${item.horas_produzidas}</td>
                <td class="${tempoClasse}">${tempoTexto}</td>
            `;

            tbody.appendChild(tr);
        });
    }

    document.getElementById("buscarBtn").addEventListener("click", async () => {
        const codigo = document.getElementById("programaInput").value.trim();
        if (!codigo) {
            alert("Digite o código do programa!");
            return;
        }

        try {
            const response = await fetch(`${apiBaseUrl}/programa/${codigo}`);
            if (!response.ok) throw new Error("Programa não encontrado");

            const dados = await response.json();
            if (dados.length === 0) alert("Programa não possui dados de produção.");

            atualizarTabela(dados);
        } catch (err) {
            alert("Erro ao buscar o programa: " + err.message);
        }
    });
</script>

</body>
</html>
